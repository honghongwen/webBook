(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{323:function(a,t,s){a.exports=s.p+"assets/img/wakuang1.731d732d.png"},324:function(a,t,s){a.exports=s.p+"assets/img/wakuang2.388c995a.png"},325:function(a,t,s){a.exports=s.p+"assets/img/wakuang3.f2ad26ea.png"},326:function(a,t,s){a.exports=s.p+"assets/img/wakuang4.67b9b6f8.png"},327:function(a,t,s){a.exports=s.p+"assets/img/wakuang5.77ce27a1.png"},376:function(a,t,s){"use strict";s.r(t);var r=s(14),e=Object(r.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"脚本攻击处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#脚本攻击处理"}},[a._v("#")]),a._v(" 脚本攻击处理")]),a._v(" "),t("h2",{attrs:{id:"过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#过程"}},[a._v("#")]),a._v(" 过程")]),a._v(" "),t("p",[a._v("当时正在学习flink，在自己的测试机器上随手敲了下top，发现cpu过高（前两天还没发现这么高的cpu）.\n"),t("img",{attrs:{src:s(323),alt:"wakuang"}}),a._v(" "),t("img",{attrs:{src:s(324),alt:"wakuang"}})]),a._v(" "),t("p",[a._v("一看是sshd的程序，以为哪位同事连在机器上做文件传输之类的操作，但是想了想有不止四个线程。这个时候就已经往挖矿程序上想了。查看了下具体是什么程序\n"),t("img",{attrs:{src:s(325),alt:"wakuang"}})]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-al")]),a._v(" /proc/pid/exe\n")])])]),t("p",[a._v("看到是/var/tmp下的命令，已经可以确定是挖矿程序了。查看下定时任务是否正常，果然，除了自己写的一个定时删下mysql的日志之外(太占磁盘)，多了一串离谱的玩意。从内个域名下了个sshd然后放在了我的/var/tmp下，还有个定时没分钟执行sshd，大大滴坏。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("crontab")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v("\n")])])]),t("p",[t("img",{attrs:{src:s(326),alt:"wakuang"}})]),a._v(" "),t("h2",{attrs:{id:"处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#处理"}},[a._v("#")]),a._v(" 处理")]),a._v(" "),t("p",[a._v("先把/var/tmp下的东西都删了。然后把定时任务也删了。然后kill掉进程")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /var/tmp/*\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("crontab")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("kill")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-9")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6897")]),a._v("\n")])])]),t("p",[a._v("google了下有人说是根据公钥爆破的\n害怕在机器上留下了authorized_keys.我把~/.ssh下的文件全删了。想着如果要用后续重新配下")]),a._v(" "),t("h2",{attrs:{id:"观察"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#观察"}},[a._v("#")]),a._v(" 观察")]),a._v(" "),t("p",[a._v("发现过了不久/var/tmp下又出了个vm.lock文件，google了下定时任务的方式，发现/etc/crontab和/etc/cron.d下也可以设置。\n在对应文件下又发现了定时任务，同样vim删除掉")]),a._v(" "),t("p",[t("img",{attrs:{src:s(327),alt:"wakuang"}})]),a._v(" "),t("p",[a._v("后续继续观察，/var/tmp下没有继续在下载文件了。")]),a._v(" "),t("p",[a._v("实在不行下个"),t("a",{attrs:{href:"https://github.com/Cisco-Talos/clamav",target:"_blank",rel:"noopener noreferrer"}},[a._v("Clamav"),t("OutboundLink")],1),a._v("扫下病毒或者用下"),t("a",{attrs:{href:"https://github.com/denyhosts/denyhosts",target:"_blank",rel:"noopener noreferrer"}},[a._v("denyhosts"),t("OutboundLink")],1),a._v("试试。")]),a._v(" "),t("p",[a._v("后续又观察了几天，发现还是不行，还是会出现这个sshd，也不知道是不是最近我下flink的时候或者啥的东西有漏洞还是什么。")]),a._v(" "),t("p",[a._v("后续使用ps -aux 发现一直有个wget操作，而且这个进程很秀，每次有好几个任务，执行完后立马消失，PID一直重新生成。\n想了想暂时没啥好办法，把wget的命令给重新命名了。这样他执行不了wget命令。\n然后后续刚好公司做安全等保，拿火绒扫了下，删了三个文件。再之后发现服务器就正常了。")]),a._v(" "),t("p",[a._v("得到的教训就是能不开外网端口就不开外网端口，开了外网端口的能做好白名单就做白名单。不然木马脚本真是无孔不入，太夸张了。")])])}),[],!1,null,null,null);t.default=e.exports}}]);