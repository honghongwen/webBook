(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{320:function(s,a,t){s.exports=t.p+"assets/img/jenkins.bb28628f.png"},321:function(s,a,t){s.exports=t.p+"assets/img/jenkins_prod.c1606871.png"},322:function(s,a,t){s.exports=t.p+"assets/img/jenkins_role.f57c0627.png"},367:function(s,a,t){"use strict";t.r(a);var e=t(14),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins"}},[s._v("#")]),s._v(" Jenkins")]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("Jenkins官网下载所需版本的war包即可"),a("a",{attrs:{href:"https://jenkins.io/zh/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载地址"),a("OutboundLink")],1),s._v("(推荐下载LTS即长期支持版本问题会比较少)\n或者查看"),a("a",{attrs:{href:"https://pkg.jenkins.io/redhat-stable/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),a("OutboundLink")],1),s._v("，使用wget等安装都可")]),s._v(" "),a("p",[s._v("jenkins并未给启动命令，所以可以自己写一个脚本避免每次都用命令查找kill。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" jenkins.war "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'grep'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$pid")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-gt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins is running...'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" jenkins.war "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--httpPort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stop"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" jenkins "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-9")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins is stop..'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Please input like this:"')]),s._v("./jenkins.sh start"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" or "')]),s._v("./jenkins stop"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])])]),a("p",[s._v("使用方式")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./jenkins.sh stop\n./jenkins.sh start\n")])])]),a("h2",{attrs:{id:"工作流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工作流程"}},[s._v("#")]),s._v(" 工作流程")]),s._v(" "),a("ol",[a("li",[s._v("拉取gitlab上代码(可指定分支，使用插件)")]),s._v(" "),a("li",[s._v("本地shell构建获取jar包或者dist文件夹")]),s._v(" "),a("li",[s._v("ssh发送到远程服务器(可先本地打成zip文件)")]),s._v(" "),a("li",[s._v("在远程服务器上执行shell,运行项目")])]),s._v(" "),a("h2",{attrs:{id:"配置步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置步骤"}},[s._v("#")]),s._v(" 配置步骤")]),s._v(" "),a("h3",{attrs:{id:"_1-步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-步骤"}},[s._v("#")]),s._v(" 1. 步骤")]),s._v(" "),a("ol",[a("li",[s._v("新建任务,选自由风格，输入名称")]),s._v(" "),a("li",[s._v("填入描述，选中丢弃旧的构建，天数和最大个数都填1")]),s._v(" "),a("li",[s._v("选中参数化构建过程，选择git参数，名称填checkBranch，描述填选择要部署的分支或tag，参数类型选择分支或标签，默认值填origin/master")]),s._v(" "),a("li",[s._v("源码管理->Repository URL填项目地址，选Credentials。Branches to build指定分支填$checkBranch。源码库浏览器选gitlab,version填10.0")]),s._v(" "),a("li",[s._v("构建，分前后端\n"),a("ol",[a("li",[s._v("后端项目\n"),a("ol",[a("li",[s._v("选调用顶层maven目标")]),s._v(" "),a("li",[s._v("选maven版本")]),s._v(" "),a("li",[s._v("目标填clean install -Dmaven.test.skip=true")]),s._v(" "),a("li",[s._v("增加构建步骤，选Execute shell script on remote host using ssh执行shell")]),s._v(" "),a("li",[s._v("ssh site选jenkins服务器")]),s._v(" "),a("li",[s._v("command填,将jar包打成zip包(可选),因为jar本身就是压缩包"),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /root/.jenkins/workspace/test_demoProject/target\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("zip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" demoProject.zip ./demoProject-1.0.0.jar\n")])])])])])]),s._v(" "),a("li",[s._v("前端项目\n"),a("ol",[a("li",[s._v("选执行shell，直接用shell打包即可，后端其实也可以如此操作")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /root/.jenkins/workspace/test_demoProject\n /usr/local/node-v13.14.0-linux-x64/bin/npm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n /usr/local/node-v13.14.0-linux-x64/bin/npm run build\n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'build success, start move directory'")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("zip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" demoProject.zip ./dist/\n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zip success'")]),s._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("同时前端项目的下一步操作中Source files直接填demoProject.zip, Remove prefix为空，remote directory填 /demoProject")]),s._v(" "),a("li",[s._v("前端的下一步中Exec command不同，将文件解压到nginx的html目录即可，对应的nginx的root也要配置到demoProject文件夹下")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/nginx\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" ./demoProject\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /usr/local/nginx /opt/jenkins/demoProject/demoProject.zip \n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" dist/ demoProject/\n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/jenkins/demoProject\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" demoProject.zip ./version\n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" version/\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" demoProject.zip ./demoProject-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y%m%d-%H%M"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(".zip \n")])])])])])]),s._v(" "),a("li",[s._v("构建后操作选Send build artifacts over SSH\n"),a("ol",[a("li",[s._v("SSH Publishers\n"),a("ol",[a("li",[s._v("SSH Server选要部署到的机器")]),s._v(" "),a("li",[s._v("Transfers Source files填 target/demoProject.zip, Remove Prefix填target/, Remote Directory填 /demoProject (发送到运行服务器的指定文件夹) Exec command填，意思是进入运行服务器该目录,删掉上一个jar包,将发送过来的zip包解压，然后备份到version目录下，执行启动程序脚本")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/jenkins/demoProject\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" demoProject-1.0.0.jar\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /opt/jenkins/demoProject /opt/jenkins/demoProject/demoProject.zip\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" demoProject.zip ./version/demoProject-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y%m%d-%H%M"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(".zip\n  ./start.sh\n")])])])])])]),s._v(" "),a("li",[s._v("增加构建后操作Delete workspace when build is done,不然服务器磁盘很快就会满")])]),s._v(" "),a("h3",{attrs:{id:"_2-start-sh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-start-sh"}},[s._v("#")]),s._v(" 2. start.sh")]),s._v(" "),a("p",[s._v("由于我的后端程序都托管给了supervisor,所以我的脚本如下。要注意的是java的jar包一定要指定好为1.0.0版本。约定好配置\n关于supervisor的配置，请看我另一篇文章"),a("RouterLink",{attrs:{to:"/yunwei/supervisor.html"}},[s._v("supervisor")])],1),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAR_PATH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/opt/jenkins/demoProject'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAR_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("demoProject-1.0.0.jar\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAR_PATH}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" demoProject"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'grep'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$pid")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Now Ready to restart demoProject application.'")]),s._v("\n  supervisorctl restart demoProject\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Dont found the demoProject application. now ready to start it'")]),s._v("\n  supervisorctl start demoProject\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Server started successfuly...'")]),s._v("\n")])])]),a("h3",{attrs:{id:"_3-jenkins全局配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-jenkins全局配置"}},[s._v("#")]),s._v(" 3.jenkins全局配置")]),s._v(" "),a("p",[s._v("对于上诉操作，其中需要用到ssh和git插件、以及maven配置和gitlab的Credentials。这些都需在jenkins中提前配置好。\n其中我的一些配置如下")]),s._v(" "),a("ul",[a("li",[s._v("全局工具配置\n"),a("ul",[a("li",[s._v("git配置 path to git executable为/usr/bin/git，这些其实有需要的就配，没需要直接用系统默认的就好，如jdk、git、maven等工具的配置")])])]),s._v(" "),a("li",[s._v("插件管理\n"),a("ul",[a("li",[s._v("Git plugin # 拉代码肯定需要")]),s._v(" "),a("li",[s._v("Publish Over SSH # 通过ssh免密传输文件需要")]),s._v(" "),a("li",[s._v("Maven Integration plugin # 构建maven项目")]),s._v(" "),a("li",[s._v("Git Parameter # 针对不同分支进行部署需要")]),s._v(" "),a("li",[s._v("Manage and Assign Roles # 给不同用户分配不同菜单视图需要")])])]),s._v(" "),a("li",[s._v("系统配置\n"),a("ul",[a("li",[s._v("Publish over SSH")])])]),s._v(" "),a("li",[s._v("Manage Credentials\n"),a("ul",[a("li",[s._v("这里的凭据自己按情况配置，如拉代码要gitlab的账号密码，直接使用username with password就ok")])])])]),s._v(" "),a("p",[s._v("publish over ssh配置如下，jenkins服务器生成ssh key，将id_rsa私钥放入jenkins的key中，同时path也填上。下方新增ssh server,填写名称和hostname.\n填上用户名如root,以及远程目录，这个目录就是传输文件的父目录，如我的都是/opt/jenkins")]),s._v(" "),a("h2",{attrs:{id:"角色分配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#角色分配"}},[s._v("#")]),s._v(" 角色分配")]),s._v(" "),a("p",[s._v("通常，公司内需分测试环境、灰度和生产环境，针对不同的人员，可能只允许其部署某个环境的代码。\n比如给测试分配灰度、给开发分配测试环境、运维则是所有环境。")]),s._v(" "),a("p",[s._v("而这种操作，我借助的是Manage and Assign Roles这个插件，同时因为针对每个环境，项目部署的地址不同。所以我采取的方案如下。")]),s._v(" "),a("p",[s._v("针对同一个项目，采取test_和prod_开头新建任务，test_xxx代表这个项目的测试任务。prod_xxx代表这个项目的生产任务。同时新建视图prod、test将任务隔离开。\n然后在角色管理中新增不同角色，使用正则匹配不同的项目，给不同成员分配不同的角色即可。需注意的是jenkins分为全局角色和子角色，需自行了解配置。")]),s._v(" "),a("p",[a("img",{attrs:{src:t(320),alt:"jenkins"}}),s._v(" "),a("img",{attrs:{src:t(321),alt:"jenkins_prod"}}),s._v(" "),a("img",{attrs:{src:t(322),alt:"jenkins_role"}})]),s._v(" "),a("h2",{attrs:{id:"使用webhook自动部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用webhook自动部署"}},[s._v("#")]),s._v(" 使用webhook自动部署")]),s._v(" "),a("p",[s._v("在项目配置中，构建触发器，勾选Build when a change is pushed to GitLab. GitLab webhook URL:\n同时高级->生成screct token。将URL和token拷贝。去到gitlab项目中,Settings->Integrations。将URL和token拷贝至其中，新增webhook.\n这样一来，每次项目代码只要推到远程，就会触发自动部署。")]),s._v(" "),a("h2",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" // 启动进程\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" /usr/share/java/jenkins.war "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--httpPort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9897")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n \n // 杀死进程\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ntpl")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-9")]),s._v(" pid\n \n // 或者\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" jenkins.war "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-9i")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);