(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{274:function(a,s,t){a.exports=t.p+"assets/img/es6.4f8961df.png"},275:function(a,s,t){a.exports=t.p+"assets/img/es7.a4a61918.png"},276:function(a,s,t){a.exports=t.p+"assets/img/es8.c866dbee.png"},277:function(a,s,t){a.exports=t.p+"assets/img/es9.8981041f.png"},343:function(a,s,t){"use strict";t.r(s);var n=t(14),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"canal同步mysql到es"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#canal同步mysql到es"}},[a._v("#")]),a._v(" Canal同步mysql到ES")]),a._v(" "),s("h2",{attrs:{id:"概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[a._v("#")]),a._v(" 概念")]),a._v(" "),s("p",[a._v("在大多数情况下，我们使用的是RDBMS。但是随着业务的增长，为了适应各种各样的运营需求，如各类报表，各类业务指标等。不得不做出去规范化的操作。\n一般的操作如下：")]),a._v(" "),s("ul",[s("li",[a._v("列级处理")])]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("冗余字段")])]),a._v(" "),s("p",[a._v("在我还是一个刚工作不久在一家体量不是很大的公司工作的时候，为了满足老板有时候奇奇怪怪的需求，不得不去破坏标标致致的表结构，比如在什么订单表上去存储一个奇奇怪怪的字段。这种操作让自己很难受同时也很难向别人解释，到最后大家不得不去每次别捏的看到这个字段在一个设计的很不错的数据表上。")]),a._v(" "),s("ul",[s("li",[a._v("表级处理")])]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("构建宽表，同步写入")])]),a._v(" "),s("p",[a._v("这种操作也不是没有，但是我从来没这么干过 - -！，大概的意思是做完业务操作后，再塞一个DO到宽表中，方便后续运营数据的查询。")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("RDBMS物化视图")])]),a._v(" "),s("p",[a._v("视图的方式我目前这家公司就有很多，由于很多业务系统年代较久且数据库用的Oracle，据说2000年左右这种方式非常普遍。")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("数据迁移 -> ES、OLAP等")])]),a._v(" "),s("p",[a._v("这种就是借助一些大数据工具或者一些开源的数据同步工具等，对数据进行迁移到ES或者Hive等数据库中，同时方案也是各种各样，工具也是非常多。如阿里云和腾讯的DTS、AWS的DMS、大数据的Sqoop、Datax以及Oracle也有GoldenGate、开源的canal等等")]),a._v(" "),s("p",[a._v("当然回归到数据同步到ES，这里可选的一些方案")]),a._v(" "),s("ul",[s("li",[a._v("双写")])]),a._v(" "),s("p",[a._v("意思就是除了向数据库中写入数据外，还同时向es中写入数据，不过不知道大家有无做过需要双写的系统，代码十分累赘，尤其是老系统的改造对改代码的人来说非常痛苦。业务复杂的时候业务代码和构建DO的代码、再加上有时候编码的具体人员经验不是很充分，代码再混淆在一起，实在无法直视。")]),a._v(" "),s("ul",[s("li",[a._v("MQ")])]),a._v(" "),s("p",[a._v("这种其实和双写差不多，意思是写入数据库后再写条消息，中间加了层MQ，双写的同时还加入了MQ组件，复杂度更高了。")]),a._v(" "),s("ul",[s("li",[a._v("Datax")])]),a._v(" "),s("p",[a._v("完全不用对业务代码进行改造，缺点是他只能做全量同步，如果时效性不高，可以考虑。或者和其他混合使用。")]),a._v(" "),s("ul",[s("li",[a._v("Canal")])]),a._v(" "),s("p",[a._v("也不用改造业务代码，且是实时同步的方式。")]),a._v(" "),s("h2",{attrs:{id:"选用canal做数据同步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选用canal做数据同步"}},[a._v("#")]),a._v(" 选用canal做数据同步")]),a._v(" "),s("h3",{attrs:{id:"_1-开启mysql的binlog-自建-阿里云上的默认开启"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-开启mysql的binlog-自建-阿里云上的默认开启"}},[a._v("#")]),a._v(" 1.开启mysql的binlog(自建，阿里云上的默认开启)")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/my.cnf\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("mysqld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nlog-bin"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mysql-bin "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 开启 binlog")]),a._v("\nbinlog-format"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("ROW "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 选择 ROW 模式")]),a._v("\nserver_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])])]),s("p",[a._v("重启mysql，查看配置是否成功")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("show variables like "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'log_bin%'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nshow variables like "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'binlog_format%'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("创建canal用户连接mysql并赋予读取binlog权限")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" grant all on *.* to canal@"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'%'")]),a._v(" identified by "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'canal'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nmysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" flush privileges"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h3",{attrs:{id:"_2-下载canal相关组件-我用的1-1-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-下载canal相关组件-我用的1-1-3"}},[a._v("#")]),a._v(" 2.下载canal相关组件，我用的1.1.3")]),a._v(" "),s("p",[a._v("1.下载deployer组件，修改conf下面的canal.properties")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /usr/local/canal-server\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /usr/local/canal-server\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://github.com/alibaba/canal/releases/download/canal-1.1.3/canal.deployer-1.1.3.tar.gz\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-xzvf")]),a._v(" canal.deployer-1.1.3.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" conf/canal.properties\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 修改下面两项")]),a._v("\ncanal.instance.parser.parallel "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 单cpu关闭此配置")]),a._v("\ncanal.destinations "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" wds "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#这个是很重要的参数，在这里指定你要创建的实例的名字，比如test1，test2等，逗号隔开")]),a._v("\n\n")])])]),s("p",[a._v("修改完配置后，要在conf目录下拷贝example到新目录wds")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v(" example/ wds\n")])])]),s("p",[a._v("修改wds中的instance.properties")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("canal.instance.master.address")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:3306　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定要读取binlog的MySQL的IP地址和端口")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("canal.instance.master.journal.name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("　　　　 "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#从指定的binlog文件开始读取数据")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("canal.instance.master.position")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("　　　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定偏移量，做过主从复制的应该都理解这两个参数。")]),a._v("\n　　　　　　　　　　　　　　　　　　　 "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#tips：binlog和偏移量也可以不指定，则canal-server会从当前的位置开始读取。我建议不设置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("canal.instance.dbUsername")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("canal　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定连接mysql的用户密码")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("canal.instance.dbPassword")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("canal  \ncanal.instance.connectionCharset "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" UTF-8　  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#字符集")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("canal.instance.filter.regex")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(".*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("*　　　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#这个是比较重要的参数，匹配库表白名单，比如我只要wds库的user表的增量数据，则这样写 wds.user")]),a._v("\n")])])]),s("p",[a._v("启动deployer")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("./bin/startup.sh\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tail")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" logs/canal/canal.log\n")])])]),s("p",[a._v("2.下载canal-adapter组件")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /usr/local/canal-adapter\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /usr/local/canal-adapter\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://github.com/alibaba/canal/releases/download/canal-1.1.3/canal.adapter-1.1.3.tar.gz\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-xzvf")]),a._v(" canal.adapter-1.1.3.tar.gz\n")])])]),s("p",[a._v("修改application.yml 主要的参数")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"^#"')]),a._v(" application.yml\n")])])]),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8081")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("jackson")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("date-format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" yyyy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("MM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("dd HH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("ss\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("time-zone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" GMT+8\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("default-property-inclusion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" non_null\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("canal.conf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" tcp "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kafka rocketMQ　　　　　　　　　　　　　　#模式")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("canalServerHost")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("11111　　　　　　　　　　 "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定canal-server的地址和端口")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("batchSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("500")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("syncBatchSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("retries")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("accessKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("secretKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n　　srcDataSources"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("　　　　　　　　　　　　　　　　　　　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#数据源配置，从哪里获取数据")]),a._v("\n　　  defaultDS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("　　　　　　　　　　　　　　　　　　　　　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定一个名字，在ES的配置中会用到，唯一")]),a._v("\n　　    url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" jdbc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3306/wds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("?")]),a._v("useUnicode=true　　　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#连接的数据库地址和一个库")]),a._v("\n　　    username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" root　　　　　　　　　　　　　　　　　　　　　　　　　　　　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#数据库的用户和密码")]),a._v("\n　　    password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("121212")]),a._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("canalAdapters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("　　　　　　　　　　　　　　　　　　　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#适配器配置")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" wds "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# canal instance Name or mq topic name　　　　#指定在canal-server配置的实例")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("groups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" g1　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#默认就好，组标示")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("outerAdapters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("　　　　　　　　　　　　　　　　　　　　　　　　　　　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#输出")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" es　　　　　　　　　　　　　　　　　　　　　　　　　　　　　  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#输出到哪里？指定es")]),a._v("\n　　    hosts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("9300　　　　　　　　　　　　　　　　　　　　　　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定es的地址，注意端口为es的传输端口9300")]),a._v("\n　　    properties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("　　　　　　　　　　　　　　　　　　\n　　      cluster.name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" mycluster　　　　　　　　　　　　　　　　　　　　　　　　　"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定es的集群名称")]),a._v("\n")])])]),s("p",[a._v("配置es部分")]),a._v(" "),s("p",[a._v("我要同步的表为\n"),s("img",{attrs:{src:t(274),alt:"es"}})]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# es目录下有三个示例配置文件，可删除，也可用来参考")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" /usr/local/canal-adapter/conf/es/mytest_user.yml user.yml\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" user.yml\n")])])]),s("p",[s("img",{attrs:{src:t(275),alt:"es"}})]),a._v(" "),s("p",[a._v("新建对应的es index。index为wds，type为user，三个属性如下")]),a._v(" "),s("p",[s("img",{attrs:{src:t(276),alt:"es"}})]),a._v(" "),s("p",[a._v("启动canal-adapter，开始同步数据")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("./bin/startup.sh\n")])])]),s("p",[a._v("启动后先做一次全量同步")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" http://127.0.0.1:8081/etl/es/test.yml "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" POST\n")])])]),s("p",[a._v("后续在数据库中新增数据，查看数据是否能正常同步")]),a._v(" "),s("p",[a._v("查看es数据\n"),s("img",{attrs:{src:t(277),alt:"es"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);