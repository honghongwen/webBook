(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{279:function(s,a,t){s.exports=t.p+"assets/img/es1.a278e35e.png"},280:function(s,a,t){s.exports=t.p+"assets/img/es2.2d402df7.png"},281:function(s,a,t){s.exports=t.p+"assets/img/es3.f1bb38e9.png"},282:function(s,a,t){s.exports=t.p+"assets/img/es4.d99cc117.png"},283:function(s,a,t){s.exports=t.p+"assets/img/es5.aedfd5b5.png"},345:function(s,a,t){"use strict";t.r(a);var e=t(14),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch"}},[s._v("#")]),s._v(" Elasticsearch")]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("目前ES已经到了8.7.0的版本，我这边选了个6.8.20的版本使用,同时es也依赖jdk环境。这里不做赘述。\n"),a("a",{attrs:{href:"https://www.elastic.co/downloads/past-releases#elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("直接复制对应版本链接选中wget就好")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.20.tar.gz\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xzvf")]),s._v(" elasticsearch-6.8.20.tar.gz\n")])])]),a("h2",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),a("p",[s._v("简单修改下集群名称和节点名称，使用单机使用下")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" config/elasticsearch.yml\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("// 去掉行开头的 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 并重命名集群名，这里命名为 compass")]),s._v("\ncluster.name: mycluster\n// 去掉行开头的 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 并重命名节点名，这里命名为 node-1")]),s._v("\nnode.name: node001\n")])])]),a("h2",{attrs:{id:"启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),a("p",[s._v("进入bin目录后台启动,可先按下面问题进行配置后再启动")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./elasticsearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n")])])]),a("p",[s._v("启动后curl localhost:9200能正常返回json就ok\n"),a("img",{attrs:{src:t(279),alt:"es"}})]),s._v(" "),a("h3",{attrs:{id:"新建用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建用户"}},[s._v("#")]),s._v(" 新建用户")]),s._v(" "),a("p",[s._v("这里启动有个问题(5版本之后)，不能使用root用户启动。日志可以在logs下mycluster.log看到，所以先建个用户")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("adduser fengwen\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" fengwen\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入确认密码后")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" fengwen elasticsearch-6.8.20\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" fengwen\n")])])]),a("h3",{attrs:{id:"修改ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改ip"}},[s._v("#")]),s._v(" 修改ip")]),s._v(" "),a("p",[s._v("调整只能本地访问问题，修改yml配置后重新启动")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" config/elasticsearch.yml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改network.host")]),s._v("\nnetwork.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n")])])]),a("h3",{attrs:{id:"文件数过小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件数过小"}},[s._v("#")]),s._v(" 文件数过小")]),s._v(" "),a("p",[s._v("查看日志发现还是无法启动，分别为每个进程同时打开的文件数太小、最大线程个数太低、一个进程最多的内存区域太小\n"),a("img",{attrs:{src:t(280),alt:"es"}})]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.最大线程数和文件数，修改limits.conf配置，用户退出后重新登录生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/security/limits.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件数")]),s._v("\n* soft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n* hard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大线程数")]),s._v("\n* soft nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n* hard nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2.最多的内存区域大小,修改sysctl.conf配置，sysctl -p后生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/sysctl.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加如下配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vm.max_map_count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n")])])]),a("h2",{attrs:{id:"分词器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分词器"}},[s._v("#")]),s._v(" 分词器")]),s._v(" "),a("p",[s._v("安装对应版本的ik中文分词器\n"),a("a",{attrs:{href:"https://github.com/medcl/elasticsearch-analysis-ik/tags?after=v6.8.23",target:"_blank",rel:"noopener noreferrer"}},[s._v("分词器地址"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./bin/elasticsearch-plugin "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.8.20/elasticsearch-analysis-ik-6.8.20.zip\n")])])]),a("p",[s._v("重启es，这样es就会自动加载分词器")]),s._v(" "),a("h2",{attrs:{id:"kibana安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kibana安装"}},[s._v("#")]),s._v(" Kibana安装")]),s._v(" "),a("p",[s._v("还有一种GUI是使用elasticsearch-head,这种chrome插件已经不支持了，同样需要node环境启动，我这里记录下。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.elastic.co/downloads/kibana",target:"_blank",rel:"noopener noreferrer"}},[s._v("kibana官网"),a("OutboundLink")],1),s._v("\n注意下kibana和ES的版本对应\n"),a("a",{attrs:{href:"https://www.elastic.co/cn/support/matrix#matrix_compatibility",target:"_blank",rel:"noopener noreferrer"}},[s._v("版本对应"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("修改下config/kibana.yml，将端口和elasticesearch的注释取消掉。然后把kibana的ip从localhost改成0.0.0.0。启动")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" bin/kibana "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),a("p",[s._v("如果没有nohub命令，注意切换root后")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" coreutils\n")])])]),a("h2",{attrs:{id:"es基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#es基本概念"}},[s._v("#")]),s._v(" ES基本概念")]),s._v(" "),a("p",[s._v("index相当于数据库中的库\ntype相当于数据库中的表")]),s._v(" "),a("p",[s._v("下面这个数据相当于新建了个库，里面有一个person的type,person有三个字段：user、title、desc，这三个字段都是中文，类型都是文本。所以指定了中文分词器。")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"mappings"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"person"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"properties"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"user"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"analyzer"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ik_max_word"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"search_analyzer"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ik_max_word"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"title"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"analyzer"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ik_max_word"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"search_analyzer"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ik_max_word"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"desc"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"analyzer"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ik_max_word"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"search_analyzer"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ik_max_word"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("img",{attrs:{src:t(281),alt:"es"}})]),s._v(" "),a("p",[s._v("针对该type新增一条数据\n"),a("img",{attrs:{src:t(282),alt:"es"}})]),s._v(" "),a("p",[s._v("查询该数据\n"),a("img",{attrs:{src:t(283),alt:"es"}})]),s._v(" "),a("p",[a("RouterLink",{attrs:{to:"/backend/canal.html"}},[s._v("数据同步看这篇文章")])],1)])}),[],!1,null,null,null);a.default=n.exports}}]);