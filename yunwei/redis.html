<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis | 山雨光云小集</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="山雨光云小集">
    
    <link rel="preload" href="/assets/css/0.styles.5ab8ebd7.css" as="style"><link rel="preload" href="/assets/js/app.1211b944.js" as="script"><link rel="preload" href="/assets/js/2.d9cdd38b.js" as="script"><link rel="preload" href="/assets/js/42.dc683951.js" as="script"><link rel="prefetch" href="/assets/js/10.8d543d8c.js"><link rel="prefetch" href="/assets/js/11.2cfcc750.js"><link rel="prefetch" href="/assets/js/12.54781427.js"><link rel="prefetch" href="/assets/js/13.f450e900.js"><link rel="prefetch" href="/assets/js/14.f76a28e8.js"><link rel="prefetch" href="/assets/js/15.fb7f9400.js"><link rel="prefetch" href="/assets/js/16.9234d627.js"><link rel="prefetch" href="/assets/js/17.e262864f.js"><link rel="prefetch" href="/assets/js/18.4e875c29.js"><link rel="prefetch" href="/assets/js/19.a995da09.js"><link rel="prefetch" href="/assets/js/20.adc26647.js"><link rel="prefetch" href="/assets/js/21.55c48e84.js"><link rel="prefetch" href="/assets/js/22.3f3a83d0.js"><link rel="prefetch" href="/assets/js/23.deed6bd2.js"><link rel="prefetch" href="/assets/js/24.746bbc50.js"><link rel="prefetch" href="/assets/js/25.2e425410.js"><link rel="prefetch" href="/assets/js/26.0c29c466.js"><link rel="prefetch" href="/assets/js/27.5e6bedfd.js"><link rel="prefetch" href="/assets/js/28.8e4a8ccc.js"><link rel="prefetch" href="/assets/js/29.020ccf97.js"><link rel="prefetch" href="/assets/js/3.7bd32064.js"><link rel="prefetch" href="/assets/js/30.43d740de.js"><link rel="prefetch" href="/assets/js/31.35476f65.js"><link rel="prefetch" href="/assets/js/32.20057b37.js"><link rel="prefetch" href="/assets/js/33.fd9470e1.js"><link rel="prefetch" href="/assets/js/34.01313131.js"><link rel="prefetch" href="/assets/js/35.45efba1c.js"><link rel="prefetch" href="/assets/js/36.74e309b1.js"><link rel="prefetch" href="/assets/js/37.e0900611.js"><link rel="prefetch" href="/assets/js/38.a0e0b9f1.js"><link rel="prefetch" href="/assets/js/39.5284a6de.js"><link rel="prefetch" href="/assets/js/4.642422bc.js"><link rel="prefetch" href="/assets/js/40.932439c4.js"><link rel="prefetch" href="/assets/js/41.ee7ac8cc.js"><link rel="prefetch" href="/assets/js/43.c38eb04b.js"><link rel="prefetch" href="/assets/js/44.3bdc7170.js"><link rel="prefetch" href="/assets/js/45.fdd93da2.js"><link rel="prefetch" href="/assets/js/5.3bc68866.js"><link rel="prefetch" href="/assets/js/6.f8936891.js"><link rel="prefetch" href="/assets/js/7.6d48973a.js"><link rel="prefetch" href="/assets/js/8.1a64b73c.js"><link rel="prefetch" href="/assets/js/9.ff7216d2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5ab8ebd7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">山雨光云小集</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://shanyuguangyun.github.io/gitBook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  基础知识
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://qms.shanyuguangyun.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  问卷网页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/shanyuguangyun/leetcode" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/shanyuguangyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://shanyuguangyun.github.io/gitBook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  基础知识
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://qms.shanyuguangyun.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  问卷网页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/shanyuguangyun/leetcode" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/shanyuguangyun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front/vue.html" class="sidebar-link">Vue知识</a></li><li><a href="/front/nvm.html" class="sidebar-link">Nvm管理Node版本</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>后端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/backend/springboot.html" class="sidebar-link">SpringBoot</a></li><li><a href="/backend/threadpool.html" class="sidebar-link">Treadpool项目中应用</a></li><li><a href="/backend/logback.html" class="sidebar-link">LogBack日志配置</a></li><li><a href="/backend/easyexcel.html" class="sidebar-link">EasyExcel使用</a></li><li><a href="/backend/fdfs.html" class="sidebar-link">FDFS使用</a></li><li><a href="/backend/redis.html" class="sidebar-link">Redis学习</a></li><li><a href="/backend/hadoop.html" class="sidebar-link">Hadoop</a></li><li><a href="/backend/elkf.html" class="sidebar-link">ELK+Filebeat的搭建</a></li><li><a href="/backend/elasticsearch.html" class="sidebar-link">Elasticsearch</a></li><li><a href="/backend/canal.html" class="sidebar-link">Canal同步mysql到ES</a></li><li><a href="/backend/oraclecdc.html" class="sidebar-link">Oracle CDC调研比较</a></li><li><a href="/backend/flinkcdc.html" class="sidebar-link">Flink-CDC同步Oracle全量+增量数据</a></li><li><a href="/backend/kafka.html" class="sidebar-link">Kafka学习总结</a></li><li><a href="/backend/arthas.html" class="sidebar-link">Arthas</a></li><li><a href="/backend/intelij.html" class="sidebar-link">Intelij一些设置</a></li><li><a href="/backend/problem.html" class="sidebar-link">常遇到的问题</a></li><li><a href="/backend/ab.html" class="sidebar-link">ab性能测试</a></li><li><a href="/backend/499.html" class="sidebar-link">一次Nginx499状态码排查</a></li><li><a href="/backend/ssm.html" class="sidebar-link">SSM项目</a></li><li><a href="/backend/oracle.html" class="sidebar-link">Oracle</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>运维手册</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yunwei/vmware.html" class="sidebar-link">VMware</a></li><li><a href="/yunwei/nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/yunwei/linux.html" class="sidebar-link">Linux</a></li><li><a href="/yunwei/vim.html" class="sidebar-link">Vim</a></li><li><a href="/yunwei/supervisor.html" class="sidebar-link">SuperVisor</a></li><li><a href="/yunwei/gitbook.html" class="sidebar-link">GitBook</a></li><li><a href="/yunwei/gitlab.html" class="sidebar-link">GitLab</a></li><li><a href="/yunwei/jenkins.html" class="sidebar-link">Jenkins</a></li><li><a href="/yunwei/redis.html" aria-current="page" class="active sidebar-link">Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yunwei/redis.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/yunwei/redis.html#主从搭建" class="sidebar-link">主从搭建</a></li><li class="sidebar-sub-header"><a href="/yunwei/redis.html#哨兵搭建" class="sidebar-link">哨兵搭建</a></li><li class="sidebar-sub-header"><a href="/yunwei/redis.html#集群搭建" class="sidebar-link">集群搭建</a></li><li class="sidebar-sub-header"><a href="/yunwei/redis.html#常用命令" class="sidebar-link">常用命令</a></li><li class="sidebar-sub-header"><a href="/yunwei/redis.html#数据结构" class="sidebar-link">数据结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yunwei/redis.html#基本的五个" class="sidebar-link">基本的五个</a></li><li class="sidebar-sub-header"><a href="/yunwei/redis.html#复杂的" class="sidebar-link">复杂的</a></li></ul></li><li class="sidebar-sub-header"><a href="/yunwei/redis.html#持久化" class="sidebar-link">持久化</a></li><li class="sidebar-sub-header"><a href="/yunwei/redis.html#其他" class="sidebar-link">其他</a></li></ul></li><li><a href="/yunwei/prometheus.html" class="sidebar-link">Prometheus</a></li><li><a href="/yunwei/rabbitmq.html" class="sidebar-link">RabbitMq</a></li><li><a href="/yunwei/wiki.html" class="sidebar-link">Confluence Wiki</a></li><li><a href="/yunwei/wakuang.html" class="sidebar-link">脚本攻击处理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h1> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p>从官网下载tar包  <a href="https://redis.io/" target="_blank" rel="noopener noreferrer">https://redis.io/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> ./redis-6.2.6.tar.gz <span class="token parameter variable">-C</span> /opt/module

<span class="token builtin class-name">cd</span> /home/software
<span class="token function">make</span>
<span class="token function">make</span> <span class="token function">install</span>  <span class="token comment">## then go to /usr/local/bin ll</span>
</code></pre></div><p>配置</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /home/software/redis-6.2.6/
<span class="token function">vi</span> redis.conf
daemonize <span class="token function">yes</span> <span class="token comment">## change the redis-server start on background.</span>
requirepass xxxx <span class="token comment">## your password</span>
logfile /home/software/redis-6.2.6/log/redis.log
<span class="token builtin class-name">bind</span> <span class="token number">0.0</span>.0.0 <span class="token comment">## anyone can connect</span>
</code></pre></div><p>启动</p> <div class="language-shell extra-class"><pre class="language-shell"><code>redis-server ./redis.conf <span class="token comment">## start server</span>

redis-cli <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-p</span> <span class="token number">6379</span> <span class="token parameter variable">-a</span> password <span class="token comment">## start client</span>

<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> foo hello
<span class="token operator">&gt;</span> get foo
</code></pre></div><h2 id="主从搭建"><a href="#主从搭建" class="header-anchor">#</a> 主从搭建</h2> <h2 id="哨兵搭建"><a href="#哨兵搭建" class="header-anchor">#</a> 哨兵搭建</h2> <h2 id="集群搭建"><a href="#集群搭建" class="header-anchor">#</a> 集群搭建</h2> <p>集群至少需要三主三从，所以至少需要六台机器</p> <p>创建文件夹</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/redis-cluster/5001 <span class="token number">5002</span><span class="token punctuation">..</span>. <span class="token number">5006</span>
</code></pre></div><p>将配置文件拷贝到目录中</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cp</span> /opt/module/redis-2.6.2/redis.conf /usr/local/redis-cluster/5001
</code></pre></div><p>修改配置文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code>pidfile /var/run/redis_5001.pid
daemonize <span class="token function">yes</span>
logfile /usr/local/redis-cluster/5001/redis.log
<span class="token function">dir</span> /usr/local/redis-cluster/5001
appendonly <span class="token function">yes</span>
appendfsync everysec
port <span class="token number">5001</span>

cluster-enabled <span class="token function">yes</span>
cluster-config-file nodes-5001.conf
cluster-node-timeout <span class="token number">15000</span>
</code></pre></div><p>同步几份配置文件到对应文件夹，并且替换5001-&gt;500x
用对应配置文件启动redis-server</p> <div class="language-shell extra-class"><pre class="language-shell"><code>redis-server /usr/local/redis-cluster/500x/redis.conf
</code></pre></div><p>使用集群搭建命令搭建集群 5.0之前使用ruby命令，5.0之后可以使用自带的命令</p> <div class="language-shell extra-class"><pre class="language-shell"><code>redis-cli <span class="token parameter variable">--cluster</span> create ip:port ip2:port2<span class="token punctuation">..</span>. --cluster-replicas n

redis-cli <span class="token parameter variable">--cluster</span> create 
<span class="token number">172.16</span>.151.100:5001
<span class="token number">172.16</span>.151.100:5002 
<span class="token number">172.16</span>.151.100:5003 
<span class="token number">172.16</span>.151.100:5004 
<span class="token number">172.16</span>.151.100:5005 
<span class="token number">172.16</span>.151.100:5006 --cluster-replicas <span class="token number">1</span> <span class="token parameter variable">-a</span> password
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>redis-cli <span class="token parameter variable">--cluster</span> <span class="token builtin class-name">help</span> <span class="token comment"># 查看帮助</span>
</code></pre></div><p>16384个slots将会平分在几个主节点上
集群模式登陆redis</p> <div class="language-shell extra-class"><pre class="language-shell"><code>redis-cli <span class="token parameter variable">--cluster</span> <span class="token parameter variable">-c</span> <span class="token parameter variable">--pass</span> password <span class="token parameter variable">-p</span> <span class="token number">5001</span>
</code></pre></div><p>!注意如果是虚拟机，磁盘是否够空间。</p> <p>增加从节点
分片</p> <blockquote><p>保障 Redis 高可用的 4 种手段：</p></blockquote> <blockquote><p>数据持久化保证了数据不丢失；</p></blockquote> <blockquote><p>Redis 主从让 Redis 从单机变成了多机。
它有两种模式：主从模式和从从模式，但当主节点出现问题时，需要人工手动恢复系统；</p></blockquote> <blockquote><p>Redis 哨兵模式用来监控 Redis 主从模式，并提供了自动容灾恢复的功能。</p></blockquote> <blockquote><p>最后是 Redis 集群，除了可以提供主从和哨兵的功能之外，
还提供了多个主从节点的集群功能，这样就可以把数据均匀的存储各个主机主节点上，
实现了系统的横向扩展，大大提高了 Redis 的并发处理能力</p></blockquote> <h2 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h2> <p>启动服务
redis-server redis.conf ## 一般在安装目录</p> <p>连接
redis-cli -h host -p port -a password</p> <p>查看慢查询</p> <p>清空数据库
flushall
flushdb</p> <p>停止服务
shutdown</p> <h2 id="数据结构"><a href="#数据结构" class="header-anchor">#</a> 数据结构</h2> <h3 id="基本的五个"><a href="#基本的五个" class="header-anchor">#</a> 基本的五个</h3> <ul><li>string</li> <li>list</li> <li>hash</li> <li>set</li> <li>sorted set</li></ul> <h3 id="复杂的"><a href="#复杂的" class="header-anchor">#</a> 复杂的</h3> <ul><li>SDS</li></ul> <p>不同于c语言的字符串，redis定义了SDS构造体，因为c语言中要拿到字符串的长度，必须重头遍历这个字符串，直到末尾\0。所以这个结构直接访问len就可以知道字符串长度，更节省了时间。
杜绝了缓冲区溢出，c语言需要提前设置内存，如果将a字符串拼接，但是忘记重新设置长度，那它就会溢出到下个字符串的位置。设计了拼接api，会先检查长度，如果不够就先扩展。
预分配空间
减少了修改字符串长度频繁的分配空间操作，c语言需要这样的操作，但是SDS有空间预分配的操作。规则如下：
1.如果分配后，SDS的长度将小于1m，那就会再设置和len想同长度的free字节。
2.如果大于1m，那就加1m。</p> <p>惰性释放
字符串缩短时，不立马释放free空间，而是留着等以后，便于后续字符串又变长。
当然也有对应api去释放这部分空间，不用担心内存浪费。</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">sdshdr</span> <span class="token punctuation">{</span>
 <span class="token comment">// 已使用字节数量 5</span>
 <span class="token keyword">int</span> len<span class="token punctuation">;</span>
 <span class="token comment">// 未使用字节数量 0</span>
 <span class="token keyword">int</span> free<span class="token punctuation">;</span>
 <span class="token comment">// 用于保存字符串 \0结尾 'R' 'e' 'd' 'i' 's' '\0'</span>
 <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="持久化"><a href="#持久化" class="header-anchor">#</a> 持久化</h2> <ul><li>RDB
可以通过SAVE命令或者BGSAVE命令（另起线程）保存dump.rdb文件
文件保存的都是二进制的键值
或者通过修改redis.conf文件</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>save <span class="token number">600</span> <span class="token number">1</span>  <span class="token comment">## 代表600秒内执行过一次命令</span>
</code></pre></div><ul><li>AOF</li></ul> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yunwei/jenkins.html" class="prev">
        Jenkins
      </a></span> <span class="next"><a href="/yunwei/prometheus.html">
        Prometheus
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1211b944.js" defer></script><script src="/assets/js/2.d9cdd38b.js" defer></script><script src="/assets/js/42.dc683951.js" defer></script>
  </body>
</html>
